import { Link } from "react-router-dom";
import "../css/Main.css";

const { useState, useEffect } = require("react");

function Main() {
  const apiKey = "c804c2461e2d3849e26d07926609f755";
  const [datas, setData] = useState(null);
  const [loading, setLoading] = useState(true);
  const [location, setLocation] = useState({ latitude: null, longitude: null });

  const getLocation = () => {
    navigator.geolocation.getCurrentPosition(
      (data) => {
        setLocation({
          latitude: data.coords.latitude,
          longitude: data.coords.longitude,
        });
      },
      () => {
        setLocation({ latitude: "err", longitude: "err" });
      }
    );
  };

  const getNoLocationData = () => {
    setLoading(true);

    fetch(
      `https://api.openweathermap.org/data/2.5/weather?id=1838524&appid=${apiKey}&units=metric`
    )
      .then((res) => res.json())
      .then((data) => setData(data))
      .then(() => setLoading(false))
      .catch(() => {
        console.log("err");
      });
  };

  const getLocationData = () => {
    setLoading(true);
    fetch(
      `https://api.openweathermap.org/data/2.5/weather?lat=${location.latitude}&lon=${location.longitude}&appid=${apiKey}&units=metric`
    )
      .then((res) => res.json())
      .then((data) => setData(data))
      .then(() => setLoading(false))
      .catch(() => {
        console.log("err");
      });
  };

  useEffect(() => {
    getLocation();
    if (location.latitude !== null && location.latitude !== "err")
      getLocationData();
    if (location.latitude === "err") getNoLocationData();
  }, [location.latitude]);

  return (
    <>
      <div className="main-container">
        <div className="main-weather">
          {loading ? null : datas.weather[0].main === "Clear" ? (
            <div className="main-top__weather">
              <span>
                <p>날씨 정보 자세히</p>
                <Link to="/weather">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    viewBox="0 0 16 16"
                    fill="none"
                  >
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M15 1.96875C15 1.70768 14.8946 1.4573 14.7071 1.27269C14.5196 1.08809 14.2652 0.984375 14 0.984375H2C1.73478 0.984375 1.48043 1.08809 1.29289 1.27269C1.10536 1.4573 1 1.70768 1 1.96875V13.7812C1 14.0423 1.10536 14.2927 1.29289 14.4773C1.48043 14.6619 1.73478 14.7656 2 14.7656H14C14.2652 14.7656 14.5196 14.6619 14.7071 14.4773C14.8946 14.2927 15 14.0423 15 13.7812V1.96875ZM0 1.96875C0 1.4466 0.210714 0.945846 0.585786 0.576634C0.960859 0.207421 1.46957 0 2 0L14 0C14.5304 0 15.0391 0.207421 15.4142 0.576634C15.7893 0.945846 16 1.4466 16 1.96875V13.7812C16 14.3034 15.7893 14.8042 15.4142 15.1734C15.0391 15.5426 14.5304 15.75 14 15.75H2C1.46957 15.75 0.960859 15.5426 0.585786 15.1734C0.210714 14.8042 0 14.3034 0 13.7812V1.96875ZM5.854 5.06559C5.76011 4.97317 5.63278 4.92125 5.5 4.92125C5.36722 4.92125 5.23989 4.97317 5.146 5.06559C5.05211 5.15801 4.99937 5.28336 4.99937 5.41406C4.99937 5.54476 5.05211 5.67011 5.146 5.76253L9.243 9.79453H6.475C6.34239 9.79453 6.21521 9.84639 6.12145 9.93869C6.02768 10.031 5.975 10.1562 5.975 10.2867C5.975 10.4173 6.02768 10.5424 6.12145 10.6347C6.21521 10.7271 6.34239 10.7789 6.475 10.7789H10.45C10.5826 10.7789 10.7098 10.7271 10.8036 10.6347C10.8973 10.5424 10.95 10.4173 10.95 10.2867V6.37383C10.95 6.24329 10.8973 6.1181 10.8036 6.0258C10.7098 5.9335 10.5826 5.88164 10.45 5.88164C10.3174 5.88164 10.1902 5.9335 10.0964 6.0258C10.0027 6.1181 9.95 6.24329 9.95 6.37383V9.09858L5.854 5.06559Z"
                      fill="white"
                    />
                  </svg>
                </Link>
              </span>
              <h1>
                오늘의 날씨는 맑음, <br />
                같이 뛸래?
              </h1>
              <img src={`/img/image4.png`} alt="맑음"></img>
            </div>
          ) : datas.weather[0].main === "Mist" ? (
            <div className="main-top__weather">
              <span>
                <p>날씨 정보 자세히</p>
                <Link to="/weather">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    viewBox="0 0 16 16"
                    fill="none"
                  >
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M15 1.96875C15 1.70768 14.8946 1.4573 14.7071 1.27269C14.5196 1.08809 14.2652 0.984375 14 0.984375H2C1.73478 0.984375 1.48043 1.08809 1.29289 1.27269C1.10536 1.4573 1 1.70768 1 1.96875V13.7812C1 14.0423 1.10536 14.2927 1.29289 14.4773C1.48043 14.6619 1.73478 14.7656 2 14.7656H14C14.2652 14.7656 14.5196 14.6619 14.7071 14.4773C14.8946 14.2927 15 14.0423 15 13.7812V1.96875ZM0 1.96875C0 1.4466 0.210714 0.945846 0.585786 0.576634C0.960859 0.207421 1.46957 0 2 0L14 0C14.5304 0 15.0391 0.207421 15.4142 0.576634C15.7893 0.945846 16 1.4466 16 1.96875V13.7812C16 14.3034 15.7893 14.8042 15.4142 15.1734C15.0391 15.5426 14.5304 15.75 14 15.75H2C1.46957 15.75 0.960859 15.5426 0.585786 15.1734C0.210714 14.8042 0 14.3034 0 13.7812V1.96875ZM5.854 5.06559C5.76011 4.97317 5.63278 4.92125 5.5 4.92125C5.36722 4.92125 5.23989 4.97317 5.146 5.06559C5.05211 5.15801 4.99937 5.28336 4.99937 5.41406C4.99937 5.54476 5.05211 5.67011 5.146 5.76253L9.243 9.79453H6.475C6.34239 9.79453 6.21521 9.84639 6.12145 9.93869C6.02768 10.031 5.975 10.1562 5.975 10.2867C5.975 10.4173 6.02768 10.5424 6.12145 10.6347C6.21521 10.7271 6.34239 10.7789 6.475 10.7789H10.45C10.5826 10.7789 10.7098 10.7271 10.8036 10.6347C10.8973 10.5424 10.95 10.4173 10.95 10.2867V6.37383C10.95 6.24329 10.8973 6.1181 10.8036 6.0258C10.7098 5.9335 10.5826 5.88164 10.45 5.88164C10.3174 5.88164 10.1902 5.9335 10.0964 6.0258C10.0027 6.1181 9.95 6.24329 9.95 6.37383V9.09858L5.854 5.06559Z"
                      fill="white"
                    />
                  </svg>
                </Link>
              </span>
              <h1>
                안개 낀 오늘,
                <br /> 러너스와 뛰러가셔야죠?
              </h1>
              <img src={`/img/Mist.png`} alt="안개"></img>
            </div>
          ) : datas.weather[0].main === "Rain" ? (
            <div className="main-top__weather">
              <span>
                <p>날씨 정보 자세히</p>
                <Link to="/weather">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    viewBox="0 0 16 16"
                    fill="none"
                  >
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M15 1.96875C15 1.70768 14.8946 1.4573 14.7071 1.27269C14.5196 1.08809 14.2652 0.984375 14 0.984375H2C1.73478 0.984375 1.48043 1.08809 1.29289 1.27269C1.10536 1.4573 1 1.70768 1 1.96875V13.7812C1 14.0423 1.10536 14.2927 1.29289 14.4773C1.48043 14.6619 1.73478 14.7656 2 14.7656H14C14.2652 14.7656 14.5196 14.6619 14.7071 14.4773C14.8946 14.2927 15 14.0423 15 13.7812V1.96875ZM0 1.96875C0 1.4466 0.210714 0.945846 0.585786 0.576634C0.960859 0.207421 1.46957 0 2 0L14 0C14.5304 0 15.0391 0.207421 15.4142 0.576634C15.7893 0.945846 16 1.4466 16 1.96875V13.7812C16 14.3034 15.7893 14.8042 15.4142 15.1734C15.0391 15.5426 14.5304 15.75 14 15.75H2C1.46957 15.75 0.960859 15.5426 0.585786 15.1734C0.210714 14.8042 0 14.3034 0 13.7812V1.96875ZM5.854 5.06559C5.76011 4.97317 5.63278 4.92125 5.5 4.92125C5.36722 4.92125 5.23989 4.97317 5.146 5.06559C5.05211 5.15801 4.99937 5.28336 4.99937 5.41406C4.99937 5.54476 5.05211 5.67011 5.146 5.76253L9.243 9.79453H6.475C6.34239 9.79453 6.21521 9.84639 6.12145 9.93869C6.02768 10.031 5.975 10.1562 5.975 10.2867C5.975 10.4173 6.02768 10.5424 6.12145 10.6347C6.21521 10.7271 6.34239 10.7789 6.475 10.7789H10.45C10.5826 10.7789 10.7098 10.7271 10.8036 10.6347C10.8973 10.5424 10.95 10.4173 10.95 10.2867V6.37383C10.95 6.24329 10.8973 6.1181 10.8036 6.0258C10.7098 5.9335 10.5826 5.88164 10.45 5.88164C10.3174 5.88164 10.1902 5.9335 10.0964 6.0258C10.0027 6.1181 9.95 6.24329 9.95 6.37383V9.09858L5.854 5.06559Z"
                      fill="white"
                    />
                  </svg>
                </Link>
              </span>
              <h1>
                비 내리는 오늘,
                <br />
                그래도 뛰어볼까?
              </h1>
              <img src={`/img/Rain.png`} alt="비"></img>
            </div>
          ) : (
            <div className="main-top__weather">
              <span>
                <Link to="/weather">
                  <p>날씨 정보 자세히</p>
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    viewBox="0 0 16 16"
                    fill="none"
                  >
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M15 1.96875C15 1.70768 14.8946 1.4573 14.7071 1.27269C14.5196 1.08809 14.2652 0.984375 14 0.984375H2C1.73478 0.984375 1.48043 1.08809 1.29289 1.27269C1.10536 1.4573 1 1.70768 1 1.96875V13.7812C1 14.0423 1.10536 14.2927 1.29289 14.4773C1.48043 14.6619 1.73478 14.7656 2 14.7656H14C14.2652 14.7656 14.5196 14.6619 14.7071 14.4773C14.8946 14.2927 15 14.0423 15 13.7812V1.96875ZM0 1.96875C0 1.4466 0.210714 0.945846 0.585786 0.576634C0.960859 0.207421 1.46957 0 2 0L14 0C14.5304 0 15.0391 0.207421 15.4142 0.576634C15.7893 0.945846 16 1.4466 16 1.96875V13.7812C16 14.3034 15.7893 14.8042 15.4142 15.1734C15.0391 15.5426 14.5304 15.75 14 15.75H2C1.46957 15.75 0.960859 15.5426 0.585786 15.1734C0.210714 14.8042 0 14.3034 0 13.7812V1.96875ZM5.854 5.06559C5.76011 4.97317 5.63278 4.92125 5.5 4.92125C5.36722 4.92125 5.23989 4.97317 5.146 5.06559C5.05211 5.15801 4.99937 5.28336 4.99937 5.41406C4.99937 5.54476 5.05211 5.67011 5.146 5.76253L9.243 9.79453H6.475C6.34239 9.79453 6.21521 9.84639 6.12145 9.93869C6.02768 10.031 5.975 10.1562 5.975 10.2867C5.975 10.4173 6.02768 10.5424 6.12145 10.6347C6.21521 10.7271 6.34239 10.7789 6.475 10.7789H10.45C10.5826 10.7789 10.7098 10.7271 10.8036 10.6347C10.8973 10.5424 10.95 10.4173 10.95 10.2867V6.37383C10.95 6.24329 10.8973 6.1181 10.8036 6.0258C10.7098 5.9335 10.5826 5.88164 10.45 5.88164C10.3174 5.88164 10.1902 5.9335 10.0964 6.0258C10.0027 6.1181 9.95 6.24329 9.95 6.37383V9.09858L5.854 5.06559Z"
                      fill="white"
                    />
                  </svg>
                </Link>
              </span>
              <h1>
                날씨가 안좋아요..ㅠ.ㅠ
                <br />
                집콕하며 재충전 해볼까요?
              </h1>
              <img src={`/img/other.png`} alt="날씨 안좋음"></img>
            </div>
          )}
        </div>
        <div className="main-middle">
          <div className="main-container__middle">
            <div>Run With Us, RUNNERS</div>
          </div>
        </div>
        <div className="main-middle__running">
          러닝이 더욱 즐거워지는 이 곳.
        </div>
        <div className="main-container__bottom">
          <div className="main-bottom__left">
            <span className="main-find">Find your</span>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="58"
              height="34"
              viewBox="0 0 58 34"
              fill="none"
            >
              <path
                id="Vector"
                d="M23.2148 3.59594L23.2474 3.62439L23.2844 3.64682C25.1981 4.80637 26.4696 6.31059 27.1344 8.15881C27.801 10.012 27.7796 11.7702 27.0879 13.4591C26.3759 14.8378 24.8062 15.6219 22.1064 15.6219C19.4037 15.6219 17.831 14.8064 17.1192 13.3573L17.1192 13.3573L17.1159 13.3508C16.3398 11.8271 16.1394 10.1431 16.5347 8.2748C16.9243 6.43376 17.8927 4.88698 19.4633 3.62464C20.2357 3.12295 20.9158 2.90142 21.5128 2.90142C22.1043 2.90142 22.6677 3.11857 23.2148 3.59594ZM39.5468 5.21563L39.5485 5.22496L39.5505 5.23422C40.1221 7.8468 40.0317 9.87611 39.3636 11.3752C38.714 12.8327 37.4854 13.8616 35.5975 14.4389C34.1365 14.3947 32.9984 13.872 32.1366 12.8853C31.2483 11.8684 30.6173 10.3165 30.2904 8.1699C30.2125 6.02125 30.5111 4.33648 31.1442 3.08087C31.7639 1.85204 32.7171 1.00678 34.0265 0.530366C35.6218 0.377842 36.8356 0.799855 37.7404 1.74724C38.7186 2.77147 39.3154 3.92543 39.5468 5.21563ZM48.0675 6.50998L48.0827 6.48888L48.0957 6.46632C48.4203 5.89979 49.0232 5.48375 50.0139 5.27596C51.0042 5.06824 52.3378 5.08036 54.0372 5.34168C55.0378 5.7013 55.7691 6.2978 56.2599 7.13037C56.7622 7.98272 57.0331 9.1184 57.0341 10.5711C56.8703 15.5062 54.7112 20.0988 50.4933 24.3567C46.2783 28.6116 40.9754 31.4 34.565 32.7146L34.5644 32.7148C28.4839 33.9694 22.3403 33.6719 16.1261 31.8167C9.9133 29.9618 5.50878 26.9889 2.84207 22.9346L2.83048 22.917L2.81746 22.9004C2.54058 22.5481 2.21871 21.876 1.86761 20.8248C1.52487 19.7986 1.16866 18.4568 0.799917 16.7942V16.6671V16.6245L0.792689 16.5824C0.710521 16.1044 0.628046 15.5649 0.545324 14.9634C0.470532 14.4196 0.485931 13.6356 0.609031 12.5913C0.725917 11.5998 1.02984 10.9173 1.46694 10.4772C1.93004 10.011 2.67934 9.58862 3.76526 9.2377C4.71223 8.93167 6.11145 9.05697 8.03071 9.74237C9.42674 11.0708 10.7637 13.2435 12.0214 16.3116C13.3149 19.4668 14.4837 21.7085 15.535 22.9824L15.5349 22.9825L15.5424 22.9912C17.4773 25.2295 20.2722 26.5126 23.8616 26.8864C26.851 27.2583 29.8184 26.9622 32.7588 26.0017C35.6886 25.0446 38.1872 23.6657 40.244 21.8586L40.2498 21.8535L40.2554 21.8482C42.0903 20.1329 43.6237 17.4103 44.8856 13.7403C46.1357 10.1042 47.199 7.71561 48.0675 6.50998Z"
                fill="black"
                stroke="black"
              />
            </svg>
            <div className="main-bottom__left__img">
              <Link to="/postlist">
                <p>RUNNING MATE</p>
              </Link>
            </div>
          </div>
          <div className="main-bottom__right">
            <span className="main-finds">Recommend !</span>
            <div className="main-bottom__right__img">
              <Link to="/postlist">
                <p>RUNNING PLACE</p>
              </Link>
            </div>
          </div>
        </div>
      </div>
    </>
  );
}

export default Main;
